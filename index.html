<!DOCTYPE html>
<!--
DADAM ENC 사이니지 페이지 (index.html)

이 파일은 '표시 전용' 페이지입니다.
- TV에 상시 송출
- 관리자 기능 없음 (진입만 가능)
- 데이터는 localStorage에서 읽기만 함
-->
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>DADAM ENC 사이니지</title>
<meta name="viewport" content="width=1920, height=1080">

<style>
/* =========================
   기본 레이아웃 / 공통 스타일
   ========================= */
*{
  box-sizing:border-box;
  font-family:Pretendard,'Noto Sans KR',sans-serif;
}
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#0b1626;
  color:#fff;
}
.wrapper{
  display:grid;
  grid-template-columns:3fr 2fr;
  height:100%;
  padding:48px;
  gap:40px;
}

/* =========================
   상단 회사명 / 시간 / 날짜
   ========================= */
.brand{
  font-size:42px;
  font-weight:800;
}
.time{
  font-size:96px;
  font-weight:700;
  margin-top:28px;
}
.date{
  font-size:30px;
  opacity:.85;
}

/* =========================
   공통 패널(파란 박스)
   ========================= */
.panel{
  background:#13263f;
  border-radius:18px;
  padding:26px;
  margin-top:24px;
}
.panel h2{
  margin:0 0 16px;
  font-size:28px;
  border-bottom:1px solid rgba(255,255,255,.15);
}

/* =========================
   날씨 영역
   ========================= */
.weather-row{
  display:flex;
  align-items:center;
  margin-bottom:16px;
}
.weather-row img{
  width:46px;
  height:46px;
  margin-right:12px;
}
.weather-main{
  font-size:22px;
}
.weather-loc strong{
  font-size:1.8em;
  font-weight:800;
}

/* =========================
   출장/외근/연차 상태 표시
   ========================= */
.person{
  display:flex;
  align-items:flex-start;
  margin-bottom:14px;
}

/* 상태 원 (유리질감 + 애니메이션) */
.dot{
  width:27px;
  height:27px;
  border-radius:50%;
  margin-right:12px;
  background:linear-gradient(145deg,rgba(255,255,255,.6),rgba(0,0,0,.2));
  position:relative;
  overflow:hidden;
}

/* 원 내부에서 움직이는 빛 */
.dot::after{
  content:"";
  position:absolute;
  inset:-50%;
  background:linear-gradient(
    120deg,
    transparent 45%,
    rgba(255,255,255,.8) 50%,
    transparent 55%
  );
  animation:shine 3.5s infinite linear;
}

/* 상태별 색상 */
.green{ background:#2ecc71; }
.yellow{ background:#f1c40f; }
.red{ background:#e74c3c; }

@keyframes shine{
  from{ transform:translateX(-100%) rotate(25deg); }
  to{ transform:translateX(100%) rotate(25deg); }
}

/* 출장 외근 텍스트 */
.name{
  font-size:1.5em;
  font-weight:800;
}
.sub{
  opacity:.8;
  margin-left:39px;
}

/* =========================
   관리자 진입 모달
   ========================= */
#adminModal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#adminBox{
  background:#13263f;
  padding:28px;
  border-radius:14px;
  width:340px;
  position:relative;
}
#adminBox input,
#adminBox button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
}
#closeAdmin{
  position:absolute;
  top:10px;
  right:14px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="wrapper">

<!-- =========================
     왼쪽 영역 (회사/시간/날씨/공지)
     ========================= -->
<div>
  <div class="brand">DADAM ENC</div>
  <div class="time" id="time"></div>
  <div class="date" id="date"></div>

  <!-- 날씨 패널 -->
  <div class="panel">
    <h2>날씨</h2>

    <!-- 본사 -->
    <div class="weather-row">
      <img id="iconHQ">
      <div>
        <div class="weather-main" id="weatherHQ"></div>
        <div class="weather-loc">
          <strong>다담이엔씨 본사</strong><br>
          마곡 보타닉게이트 지식산업센터
        </div>
      </div>
    </div>

    <!-- 공장 -->
    <div class="weather-row">
      <img id="iconFactory">
      <div>
        <div class="weather-main" id="weatherFactory"></div>
        <div class="weather-loc">
          <strong>다담이엔씨 공장</strong><br>
          충청남도 당진시 순성면 731-19
        </div>
      </div>
    </div>

    <!-- 오리온 R&D -->
    <div class="weather-row">
      <img id="iconOrion">
      <div>
        <div class="weather-main" id="weatherOrion"></div>
        <div class="weather-loc">
          <strong>오리온 R&D센터 현장</strong><br>
          서울특별시 강남구 도곡동 177-6
        </div>
      </div>
    </div>
  </div>

  <!-- 사내 공지사항 -->
  <div class="panel">
    <h2>사내 공지사항</h2>
    <div id="notice"></div>
  </div>
</div>

<!-- =========================
     오른쪽 영역 (출장/업무)
     ========================= -->
<div>
  <div class="panel">
    <h2>출장 · 외근 현황</h2>
    <div id="travelList"></div>
  </div>

  <div class="panel">
    <h2>업무 일정</h2>
    <div id="schedule"></div>
  </div>
</div>

</div>

<!-- 관리자 모달 -->
<div id="adminModal">
  <div id="adminBox">
    <div id="closeAdmin" onclick="closeAdmin()">✕</div>
    <h2>관리자 액세스</h2>
    <input type="password" id="adminPw" placeholder="비밀번호">
    <button onclick="login()">확인</button>
  </div>
</div>

<script>
/* =========================
   시간/날짜 실시간 갱신
   ========================= */
function updateTime(){
  const n = new Date();
  time.innerText = n.toLocaleTimeString('ko-KR');
  date.innerText = n.toLocaleDateString(
    'ko-KR',
    {year:'numeric',month:'2-digit',day:'2-digit',weekday:'short'}
  );
}
setInterval(updateTime,1000);
updateTime();

/* =========================
   날씨 API 호출 함수
   ========================= */
async function loadWeather(lat,lon,iconEl,textEl){
  const res = await fetch(
    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=kr&appid=a33a7b44981e0a4738c0a7a023bbc7b9`
  );
  const data = await res.json();
  textEl.innerText =
    `${data.weather[0].description} · ${Math.round(data.main.temp)}℃`;
  iconEl.src =
    `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
}

/* 좌표별 날씨 호출 */
loadWeather(37.56015,126.82695,iconHQ,weatherHQ);
loadWeather(36.864687409697794,126.70225194391269,iconFactory,weatherFactory);
loadWeather(37.48698715399347,127.04622944228052,iconOrion,weatherOrion);

/* =========================
   데이터 렌더링
   ========================= */
function render(){
  const travel =
    JSON.parse(localStorage.getItem("travel")||"[]");
  const schedules =
    JSON.parse(localStorage.getItem("schedule")||"[]");

  notice.innerText =
    localStorage.getItem("notice") || "";

  travelList.innerHTML = "";
  schedule.innerHTML = "";

  /* 출장/외근 현황 */
  travel.forEach(p=>{
    travelList.innerHTML += `
      <div class="person">
        <span class="dot ${p.color}"></span>
        <div>
          <div class="name">${p.name}</div>
          <div class="sub">
            ${p.department} · ${p.task}
          </div>
        </div>
      </div>`;
  });

  /* 업무 일정 */
  schedules.forEach(s=>{
    schedule.innerHTML += `
      <div style="margin-bottom:12px">
        <strong>${s.date} · ${s.title}</strong>
        <div>${s.detail}</div>
      </div>`;
  });
}

/* 0.5초 주기로 관리자 변경사항 반영 */
setInterval(render,500);
render();

/* =========================
   관리자 접근 로직
   ========================= */
let seq = "";
const target = "ADMIN";

document.addEventListener("keydown",e=>{
  seq += e.key.toUpperCase();
  if(!target.startsWith(seq)) seq = "";
  if(seq === target){
    adminModal.style.display = "flex";
    seq = "";
  }
});

function closeAdmin(){
  adminModal.style.display = "none";
  adminPw.value = "";
}

function login(){
  if(adminPw.value === "2356"){
    location.href = "admin.html";
  }else{
    alert("비밀번호 오류");
  }
}
</script>
</body>
</html>
